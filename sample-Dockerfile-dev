FROM node:erbium-alpine
WORKDIR /root

# Installing the serve-prepare script
RUN npm install --global @fizker/serve-prepare@0.2

# Always skip compression in dev-mode, to save time
ENV -e SERVE_SKIP_COMPRESSION=true

# Copy the setup-request
COPY serve-setup-request.json ./serve-setup-request.json

### Copy HTTPS certificates
COPY key.pem cert.pem ./https/
ENV HTTPS_KEY=https/key.pem HTTPS_CERT=https/cert.pem HTTPS_PORT=443

ENV PORT=80
ENTRYPOINT [ "serve-prepare", "serve", "--request=serve-setup-request.json", "--target=target" ]
